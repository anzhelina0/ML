# HW3 — Классификация и сегментация с U-Net

Домашнее задание посвящено:
- обучению сверточного классификатора,
- построению базовой U-Net для бинарной сегментации,
- использованию энкодера классификатора в качестве бэкбона U-Net.

Работа выполнена на PyTorch.

---

## Часть 2. Базовая U-Net для сегментации «Луны»

### Датасет
Используется датасет **MOON_SEGMENTATION_BINARY** из семинара 3.

Структура данных:
data/images/render/ — входные изображения
data/images/ground/ — бинарные маски

Все изображения приведены к размеру **128×128**.

---

### Архитектура модели

Использована классическая архитектура **U-Net**:
- 4 уровня энкодера и 4 уровня декодера
- Downsampling: `MaxPool2d (2×2)`
- Upsampling: `ConvTranspose2d`
- Skip-связи между соответствующими уровнями
- Базовое число каналов: **64**
- Выход: 1 канал
- Активация на выходе: `Sigmoid`

Вход модели: `128×128×3`  
Выход модели: `128×128×1`

---

### Обучение
- Лосс-функция: `BCEWithLogitsLoss`
- Оптимизатор: `Adam`
- Количество эпох: 5
- Аугментации: горизонтальный флип

---

### Метрики
Для оценки качества сегментации использовались:
- **Dice**
- **IoU (Jaccard)**
- **Pixel Accuracy**

Также были выполнены визуализации результатов (входное изображение, предсказанная маска, GT маска).

---

## Часть 3. U-Net с бэкбоном из классификатора

### Идея
В данной части используется **энкодер из классификационной модели** в качестве бэкбона для U-Net.

- Полносвязная часть классификатора (GAP + FC) удалена
- Сверточные блоки используются как энкодер U-Net
- Использована стратегия **заморозки весов энкодера (frozen backbone)**

---

### Архитектура
- Энкодер: сверточные блоки классификатора
- Декодер: стандартный U-Net декодер
- Skip-связи сохранены
- Выходной слой: 1 канал + `Sigmoid`

---

### Обучение
- Энкодер заморожен
- Обучаются только веса декодера
- Датасет и метрики те же, что и в части 2
- Количество эпох: 5

---

### Сравнение моделей

| Модель                   | Dice | IoU  | Pixel Accuracy |
|--------------------------|------|------|----------------|
| Базовая U-Net            | 0.62 | 0.45 | 0.86           |
| U-Net с frozen бэкбоном  | 0.68 | 0.53 | 0.86           |

---

### Вывод

Использование энкодера классификатора в качестве бэкбона U-Net позволило улучшить качество сегментации по метрикам Dice и IoU по сравнению с базовой U-Net. Даже при замороженных весах энкодера модель показывает более устойчивые и качественные результаты.

---

## Структура репозитория

3HW/
├── data/
│ └── images/
│ ├── render/
│ └── ground/
├── models/
│ ├── unet.py
│ └── unet_with_backbone.py
├── train.py
├── visualize.py
├── metrics.py
├── requirements.txt
├── README.md
└── .gitignore

---

## Запуск

```bash
pip install -r requirements.txt
python train.py
python visualize.py
